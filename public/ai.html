<!DOCTYPE html>  <html lang="mr">  
<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
<title>Smart Sheti - AI</title>  <style>  
*{box-sizing:border-box;}  
body{  
  margin:0;background:#e8f5e9;font-family:Arial;height:100vh;display:flex;flex-direction:column;  
}  
  
/* HEADER */  
header{  
  background:#2e7d32;color:#fff;padding:14px;display:flex;align-items:center;  
  font-size:18px;gap:12px;position:relative;z-index:20;  
}  
.menuBtn{font-size:22px;cursor:pointer;}  
  
/* SIDE MENU */  
#sideMenu{  
  position:fixed;top:0;left:-260px;width:260px;height:100%;background:#ffffff;  
  padding:14px;box-shadow:2px 0 8px rgba(0,0,0,0.2);transition:0.3s;z-index:15;  
  overflow-y: auto;  
}  
#sideMenu.show{left:0;}  
.history-item{  
  padding:10px;border-bottom:1px solid #ddd;cursor:pointer;  
  display:flex;justify-content:space-between;align-items:center;font-size: 14px;  
}  
  
/* History Action Box */  
.history-actions{  
  position:fixed;bottom:30px;left:50%;transform:translateX(-50%);  
  width:200px;background:#fff;border:1px solid #ccc;border-radius:10px;  
  padding:10px;display:none;z-index:30;box-shadow: 0 4px 10px rgba(0,0,0,0.2);  
}  
.history-actions button{  
  background:none;border:none;padding:10px;text-align:left;font-size:15px;width:100%;border-bottom: 1px solid #eee;  
}  
  
/* DARK OVERLAY */  
#overlay{  
  position:fixed;top:0;left:0;width:100%;height:100%;  
  background:rgba(0,0,0,0.45);display:none;z-index:10;  
}  
  
/* CHAT */  
#chatBox{flex:1;padding:12px;overflow-y:auto;display: flex;flex-direction: column;}  
.user,.ai{  
  max-width:85%;padding:10px 12px;margin:6px 0;border-radius:14px;font-size:15px;line-height: 1.4;  
}  
.user{background:#c8e6c9;align-self: flex-end;}  
.ai{background:#fff;border:1px solid #ddd;align-self: flex-start;}  
.chat-img{max-width: 100%;border-radius: 8px;margin-top: 5px;}  
  
/* PREVIEW BOX */  
#previewBox{  
  display:none;padding:8px;background:#fff;border-top:1px solid #ddd;align-items: center;gap: 10px;  
}  
#previewImg{width: 50px;height: 50px;object-fit: cover;border-radius: 5px;}  
  
/* INPUT BAR */  
#inputBar{  
  display:flex;gap:6px;padding:8px;background:#fff;border-top:1px solid #ccc;align-items: center;  
}  
#inputBar input{  
  flex:1;padding:10px;border-radius:20px;border:1px solid #ccc;font-size:15px;outline: none;  
}  
.iconBtn{  
  background:#2e7d32;border:none;color:#fff;width:38px;height:38px;border-radius:50%;cursor: pointer;  
}  
.sendBtn{background:#1565c0;}  
</style>  </head>  <body>  <header>  
  <span class="menuBtn" onclick="toggleMenu()">‚ò∞</span>  
  ü§ñ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä AI ‡§Æ‡§ø‡§§‡•ç‡§∞  
</header>  <div id="overlay" onclick="closeMenu()"></div>  <div id="sideMenu">  
  <h3>üìú ‡§Æ‡§æ‡§ù‡•Ä ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä</h3>  
  <input id="searchHistory" oninput="filterHistory()" placeholder="‡§ö‡•Ö‡§ü ‡§∂‡•ã‡§ß‡§æ..." style="width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;margin-bottom: 10px;">  
  <div id="historyList"></div>  
  <button onclick="clearAllHistory()" style="margin-top:15px;background:#d32f2f;color:#fff;padding:10px;width:100%;border:none;border-radius:6px;cursor:pointer;">üóëÔ∏è ‡§∏‡§∞‡•ç‡§µ ‡§°‡§æ‡§ü‡§æ ‡§°‡§ø‡§≤‡§ø‡§ü</button>  
</div>  <div id="chatBox"></div>  <div id="previewBox">  
  <img id="previewImg" src="">  
  <span style="font-size: 12px;flex: 1;">‡§´‡•ã‡§ü‡•ã ‡§®‡§ø‡§µ‡§°‡§≤‡§æ ‡§Ü‡§π‡•á...</span>  
  <button onclick="cancelImage()" style="background:none;border:none;font-size:20px;color:red;">√ó</button>  
</div>  <div id="inputBar">  
  <button class="iconBtn" onclick="openCamera()">üì∑</button>  
  <button class="iconBtn" onclick="openGallery()">üñºÔ∏è</button>  
  <input id="userInput" placeholder="‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§≤‡§ø‡§π‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§´‡•ã‡§ü‡•ã ‡§™‡§æ‡§†‡§µ‡§æ...">  
  <button class="iconBtn sendBtn" onclick="sendMessage()">‚û§</button>    <input type="file" id="cameraInput" accept="image/*" capture="environment" hidden onchange="handleFile(this)">  
  <input type="file" id="galleryInput" accept="image/*" hidden onchange="handleFile(this)">  
</div>  <script>  
const chatBox=document.getElementById("chatBox");  
const input=document.getElementById("userInput");  
let selectedImage = null;  
  
// ‡§≤‡•ã‡§ï‡§≤ ‡§∏‡•ç‡§ü‡•ã‡§∞‡•á‡§ú ‡§Æ‡§ß‡•Ç‡§® ‡§°‡•á‡§ü‡§æ ‡§ò‡•á‡§£‡•á  
let history = JSON.parse(localStorage.getItem("chatHistory") || "[]");  
renderHistory();  
  
/* ---------------- MENU / SIDEBAR ---------------- */  
function toggleMenu(){  
  const menu=document.getElementById("sideMenu");  
  const overlay=document.getElementById("overlay");  
  menu.classList.toggle("show");  
  overlay.style.display = menu.classList.contains("show") ? "block" : "none";  
  if(menu.classList.contains("show")) renderHistory();  
}  
function closeMenu(){  
  document.getElementById("sideMenu").classList.remove("show");  
  document.getElementById("overlay").style.display="none";  
}  
  
/* ---------------- PHOTO HANDLING ---------------- */  
function openCamera(){ document.getElementById("cameraInput").click(); }  
function openGallery(){ document.getElementById("galleryInput").click(); }  
  
function handleFile(input) {  
  const file = input.files[0];  
  if (file) {  
    const reader = new FileReader();  
    reader.onload = function(e) {  
      selectedImage = e.target.result;  
      document.getElementById("previewImg").src = selectedImage;  
      document.getElementById("previewBox").style.display = "flex";  
    };  
    reader.readAsDataURL(file);  
  }  
}  
  
function cancelImage() {  
  selectedImage = null;  
  document.getElementById("previewBox").style.display = "none";  
  document.getElementById("cameraInput").value = "";  
  document.getElementById("galleryInput").value = "";  
}  
  
/* ---------------- MESSAGE SEND ---------------- */  
async function sendMessage(){  
  const text = input.value.trim();  
  if(!text && !selectedImage) return;  
  
  // ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§µ‡§∞ ‡§Æ‡•á‡§∏‡•á‡§ú ‡§¶‡§æ‡§ñ‡§µ‡§£‡•á  
  const userDiv = document.createElement("div");  
  userDiv.className = "user";  
  if(selectedImage) userDiv.innerHTML += `<img src="${selectedImage}" class="chat-img"><br>`;  
  if(text) userDiv.innerHTML += `<span>${text}</span>`;  
  chatBox.appendChild(userDiv);  
  chatBox.scrollTop = chatBox.scrollHeight;  
  
  // ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡§∞‡§£‡•á  
  saveHistory(text || "‡§´‡•ã‡§ü‡•ã ‡§∏‡§Ç‡§¶‡•á‡§∂");  
  
  const currentImage = selectedImage; // ‡§™‡§æ‡§†‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§æ  
  cancelImage(); // ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡•ç‡§≤‡§ø‡§Ö‡§∞ ‡§ï‡§∞‡§æ  
  input.value = "";  
  
  add("‚è≥ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡§§ ‡§Ü‡§π‡•á...", "ai", "loading-msg");  
  
  try{  
    const res = await fetch("/api/chat", {  
      method: "POST",  
      headers: { "Content-Type": "application/json" },  
      body: JSON.stringify({ prompt: text, image: currentImage })  
    });  
    const data = await res.json();  
      
    // ‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ö‡§∏‡§≤‡•á‡§≤‡§æ ‡§Æ‡•á‡§∏‡•á‡§ú ‡§ï‡§æ‡§¢‡§£‡•á  
    const loader = document.querySelector(".loading-msg");  
    if(loader) loader.remove();  
  
    add(data.reply || "‡§ï‡•ç‡§∑‡§Æ‡§∏‡•ç‡§µ, ‡§â‡§§‡•ç‡§§‡§∞ ‡§Æ‡§ø‡§≥‡§æ‡§≤‡•á ‡§®‡§æ‡§π‡•Ä.", "ai");  
  } catch(err) {  
    const loader = document.querySelector(".loading-msg");  
    if(loader) loader.remove();  
    add("‚ùå ‡§∏‡§∞‡•ç‡§µ‡•ç‡§π‡§∞‡§∂‡•Ä ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§π‡•ã‡§ä ‡§∂‡§ï‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä.", "ai");  
  }  
}  
  
function add(t, c, id=""){  
  const d=document.createElement("div");  
  d.className=c;  
  if(id) d.classList.add(id);  
  d.innerText=t;  
  chatBox.appendChild(d);  
  chatBox.scrollTop=chatBox.scrollHeight;  
}  
  
/* ---------------- HISTORY LOGIC ---------------- */  
function saveHistory(text){  
  history.unshift({txt:text, pin:false, date: new Date().toLocaleString()});  
  localStorage.setItem("chatHistory", JSON.stringify(history));  
}  
  
function renderHistory(list = history){  
  const box=document.getElementById("historyList");  
  box.innerHTML="";  
  list.forEach((h,i)=>{  
    box.innerHTML += `  
      <div class="history-item" onclick="openOptions(${i})">  
        <span>${h.pin ? "üìå" : "üí¨"} ${h.txt.slice(0,20)}...</span>  
        <small style="font-size:10px; color:gray;">${h.date.split(',')[0]}</small>  
      </div>`;  
  });  
}  
  
function filterHistory() {  
  const term = document.getElementById("searchHistory").value.toLowerCase();  
  const filtered = history.filter(h => h.txt.toLowerCase().includes(term));  
  renderHistory(filtered);  
}  
  
function openOptions(i){  
  const existing = document.querySelector(".history-actions");  
  if(existing) existing.remove();  
  
  const menu=document.createElement("div");  
  menu.className="history-actions";  
  menu.style.display="block";  
  menu.innerHTML=`  
    <button onclick="pinChat(${i})">üìå ${history[i].pin ? '‡§Ö‡§®‡§™‡§ø‡§®' : '‡§™‡§ø‡§®'} ‡§ï‡§∞‡§æ</button>  
    <button onclick="renameChat(${i})">‚úèÔ∏è ‡§®‡§æ‡§µ ‡§¨‡§¶‡§≤‡§æ</button>  
    <button onclick="deleteChat(${i})">üóëÔ∏è ‡§π‡§ü‡§µ‡§æ</button>  
  `;  
  document.body.appendChild(menu);  
    
  setTimeout(() => {  
    document.addEventListener("click", (e) => {  
        if(!menu.contains(e.target)) menu.remove();  
    }, {once:true});  
  }, 100);  
}  
  
function pinChat(i){ history[i].pin = !history[i].pin; save(); }  
function renameChat(i){   
  let n=prompt("‡§®‡§µ‡•Ä‡§® ‡§®‡§æ‡§µ ‡§¶‡•ç‡§Ø‡§æ:", history[i].txt);   
  if(n) { history[i].txt=n; save(); }  
}  
function deleteChat(i){ history.splice(i,1); save(); }  
function clearAllHistory(){   
  if(confirm("‡§∏‡§∞‡•ç‡§µ ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§ï‡§æ‡§Ø‡§Æ‡§ö‡§æ ‡§π‡§ü‡§µ‡§æ‡§Ø‡§ö‡§æ ‡§ï‡§æ?")) {  
    localStorage.removeItem("chatHistory");   
    history=[];   
    renderHistory();   
  }  
}  
function save(){   
  localStorage.setItem("chatHistory", JSON.stringify(history));   
  renderHistory();   
}  
</script>  </body>  
</html> 
