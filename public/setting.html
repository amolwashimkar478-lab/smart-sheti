<!DOCTYPE html>
<html lang="mr" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚öôÔ∏è Settings - Smart Sheti</title>
<style>
:root { --bg-color: #f0f2f5; --card-bg: #ffffff; --text-color: #1c1e21; --primary-color: #2e7d32; --border-color: #ddd; }
[data-theme="dark"] { --bg-color: #121212; --card-bg: #1e1e1e; --text-color: #e4e6eb; --primary-color: #4caf50; --border-color: #333; }
body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); transition: 0.3s; margin: 0; }
.header { background: #2e7d32; color: white; padding: 15px; display: flex; align-items: center; gap: 15px; }
.container { width: 95%; max-width: 450px; margin: 20px auto; }
.card { background: var(--card-bg); padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; text-align: center; }
.profile-pic { width: 110px; height: 110px; border-radius: 50%; border: 3px solid #2e7d32; object-fit: cover; }
input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color); outline: none; }
.btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
.btn-edit { background: #555; color: white; }
.btn-save { background: #2e7d32; color: white; display: none; }
.btn-orange { background: #ff9800; color: white; }
.btn-red { background: #f44336; color: white; }
</style>
</head>
<body>

<div class="header">
  <span style="font-size:24px; cursor:pointer;" onclick="location.href='home.html'">‚Üê</span>
  <h2>‡§Ö‡•Ö‡§™ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó</h2>
</div>

<div class="container">
  <div class="card">
    <div onclick="document.getElementById('fileInput').click()" style="position:relative; display:inline-block; cursor:pointer;">
      <img src="https://via.placeholder.com/120" id="profileImg" class="profile-pic">
      <div style="position:absolute; bottom:5px; right:5px; background:#2e7d32; color:white; border-radius:50%; width:30px; height:30px; display:flex; align-items:center; justify-content:center; border:2px solid white;">üì∑</div>
    </div>
    <input type="file" id="fileInput" accept="image/*" style="display:none;">
    <input type="text" id="nameField" placeholder="‡§§‡•Å‡§Æ‡§ö‡§Ç ‡§®‡§æ‡§µ" disabled>
    <button class="btn btn-edit" id="editBtn">‡§è‡§°‡§ø‡§ü (Edit)</button>
    <button class="btn btn-save" id="saveProfile">‡§∏‡•á‡§µ‡•ç‡§π (Save)</button>
  </div>

  <div class="card">
    <label style="display:block; margin-bottom:5px; font-weight:600;">üé® ‡§•‡•Ä‡§Æ (Theme)</label>
    <select id="themeSelect">
        <option value="light">Light Mode</option>
        <option value="dark">Dark Mode</option>
    </select>
  </div>

  <div class="card">
    <button class="btn btn-orange" id="logoutBtn">‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü</button>
    <button class="btn btn-red" id="deleteBtn">‡§ñ‡§æ‡§§‡•á ‡§π‡§ü‡§µ‡§æ</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut, deleteUser, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyA1M7dJ9KFVe1GAGWPPqLuAT7BEuIKsZkM",
  authDomain: "smart-sheti-6512e.firebaseapp.com",
  projectId: "smart-sheti-6512e",
  storageBucket: "smart-sheti-6512e.firebasestorage.app",
  messagingSenderId: "1086459599128",
  appId: "1:1086459599128:web:03a34ed9ea2b95b1ebe66d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
let base64Image = "";

onAuthStateChanged(auth, (user) => {
  if (user) {
    document.getElementById("nameField").value = user.displayName || "";
    if(user.photoURL) document.getElementById("profileImg").src = user.photoURL;
  } else {
    window.location.replace("index.html");
  }
});

// ‡§•‡•Ä‡§Æ ‡§¨‡§¶‡§≤‡§£‡•á
document.getElementById("themeSelect").onchange = (e) => {
  document.documentElement.setAttribute("data-theme", e.target.value);
};

// ‡§´‡•ã‡§ü‡•ã ‡§¨‡§¶‡§≤‡§£‡•á
document.getElementById("fileInput").onchange = (e) => {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = (event) => {
    document.getElementById("profileImg").src = event.target.result;
    base64Image = event.target.result;
    document.getElementById("editBtn").style.display = "none";
    document.getElementById("saveProfile").style.display = "block";
  };
  reader.readAsDataURL(file);
};

document.getElementById("editBtn").onclick = () => {
  document.getElementById("nameField").disabled = false;
  document.getElementById("nameField").focus();
  document.getElementById("editBtn").style.display = "none";
  document.getElementById("saveProfile").style.display = "block";
};

document.getElementById("saveProfile").onclick = async () => {
  const user = auth.currentUser;
  const updateData = { displayName: document.getElementById("nameField").value };
  if(base64Image) updateData.photoURL = base64Image;

  try {
    await updateProfile(user, updateData);
    alert("‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§ú‡§§‡§® ‡§ù‡§æ‡§≤‡•Ä!");
    location.reload();
  } catch(err) { alert(err.message); }
};

document.getElementById("logoutBtn").onclick = () => {
    if(confirm("‡§¨‡§æ‡§π‡•á‡§∞ ‡§™‡§°‡§æ‡§Ø‡§ö‡•á ‡§ï‡§æ?")) signOut(auth);
};

document.getElementById("deleteBtn").onclick = () => {
    if(confirm("‡§∏‡§æ‡§µ‡§ß‡§æ‡§®! ‡§§‡•Å‡§Æ‡§ö‡•á ‡§ñ‡§æ‡§§‡•á ‡§ï‡§æ‡§Ø‡§Æ‡§ö‡•á ‡§π‡§ü‡§µ‡§≤‡•á ‡§ú‡§æ‡§à‡§≤.")) deleteUser(auth.currentUser);
};
</script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js');
    });
  }
</script>
</body>
</html>
