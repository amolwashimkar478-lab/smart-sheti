<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>рдорд╛рдЭрдВ рд╕реНрдорд╛рд░реНрдЯ рд╢реЗрдд - рдорд▓реНрдЯреА рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди</title>
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f4f7f4; margin: 0; padding: 15px; }
        .container { max-width: 550px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2, h3 { color: #2e7d32; text-align: center; }
        label { font-weight: bold; display: block; margin-top: 10px; }
        select, input { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .btn-add { width: 100%; margin-top: 15px; padding: 12px; background: #2e7d32; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-home { background: #2196F3; color: white; padding: 15px; border: none; border-radius: 10px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; text-decoration: none; display: block; text-align: center; margin-top: 10px; }
        .crop-item { background: #e8f5e9; padding: 15px; border-radius: 12px; border-left: 6px solid #2e7d32; margin-bottom: 15px; position: relative; }
        .delete-btn { position: absolute; top: 10px; right: 10px; background: #ff5252; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; }
        .advice-text { margin-top: 8px; color: #1b5e20; line-height: 1.4; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>ЁЯЪЬ рдирд╡реАрди рдкреАрдХ рдЬреЛрдбрд╛</h2>
        <label>рд╣рдВрдЧрд╛рдо рдирд┐рд╡рдбрд╛</label>
        <select id="seasonSelect" onchange="loadCrops()">
            <option value="">-- рдирд┐рд╡рдбрд╛ --</option>
            <option value="KHARIF">ЁЯМзя╕П рдЦрд░реАрдк</option>
            <option value="RABI">тЭДя╕П рд░рдмреНрдмреА</option>
            <option value="SUMMER">тШАя╕П рдЙрдиреНрд╣рд╛рд│реА</option>
            <option value="OTHER">ЁЯМ┐ рдЪрд╛рд░рд╛ рд╡ рдорд╕рд╛рд▓реЗ</option>
        </select>

        <label>рдкреАрдХ рдирд┐рд╡рдбрд╛</label>
        <select id="cropSelect"><option value="">рдЖрдзреА рд╣рдВрдЧрд╛рдо рдирд┐рд╡рдбрд╛</option></select>

        <label>рд▓рд╛рдЧрд╡рдб рддрд╛рд░реАрдЦ</label>
        <input type="date" id="plantDate">

        <button class="btn-add" onclick="addNewCrop()">тЮХ рдкреАрдХ рдЬреЛрдбрд╛</button>
    </div>

    <div id="myCropsArea">
        <h3>ЁЯМ▒ рддреБрдордЪреА рдкрд┐рдХреЗ рдЖрдгрд┐ рд╕рд▓реНрд▓рд╛</h3>
        <div id="cropsList"></div>
    </div>

    <button class="btn-home" onclick="location.href='home.html'">ЁЯПа рд╣реЛрдорд╡рд░ рдЬрд╛</button>
</div>

<script>
// резреиреж+ рдкрд┐рдХрд╛рдВрдЪреА рдпрд╛рджреА (рдпреЗрдереЗ рддреБрдореНрд╣реА рдкрд┐рдХреЗ рд╡рд╛рдврд╡реВ рд╢рдХрддрд╛)
const cropNames = { 
    "cotton":"рдХрд╛рдкреВрд╕", "soybean":"рд╕реЛрдпрд╛рдмреАрди", "rice":"рднрд╛рдд", "tur":"рддреВрд░",
    "wheat":"рдЧрд╣реВ", "gram":"рд╣рд░рднрд░рд╛", "onion":"рдХрд╛рдВрджрд╛", "garlic":"рд▓рд╕реВрдг",
    "watermelon":"рдХрд▓рд┐рдВрдЧрдб", "muskmelon":"рдЦрд░рдмреВрдЬ", "chilli":"рдорд┐рд░рдЪреА", "turmeric":"рд╣рд│рдж"
};

// рд╕рд▓реНрд▓реНрдпрд╛рдВрдЪрд╛ рдбреЗрдЯрд╛рдмреЗрд╕
const advices = {
    "cotton": { 30: "ЁЯМ▒ рдХрд╛рдкреВрд╕: рдЦрдд рдорд╛рддреНрд░рд╛ рджреНрдпрд╛.", 50: "тЪая╕П рдХрд╛рдкреВрд╕: рдмреЛрдВрдбрдЕрд│реА рд╕рд╛рдкрд│реЗ рд▓рд╛рд╡рд╛.", 80: "ЁЯМ╕ рдХрд╛рдкреВрд╕: рдлрд╡рд╛рд░рдгреА рдХрд░рд╛." },
    "soybean": { 20: "ЁЯМ┐ рд╕реЛрдпрд╛рдмреАрди: рддрдг рдирд┐рдпрдВрддреНрд░рдг.", 45: "ЁЯМ╕ рд╕реЛрдпрд╛рдмреАрди: рдлреБрд▓рдзрд╛рд░рдгрд╛ рдкрд╛рдгреА рджреНрдпрд╛.", 70: "ЁЯРЫ рд╕реЛрдпрд╛рдмреАрди: рдЕрд│реА рдирд┐рдпрдВрддреНрд░рдг." },
    "wheat": { 21: "ЁЯТз рдЧрд╣реВ: рдкрд╣рд┐рд▓реЗ рдкрд╛рдгреА рджреНрдпрд╛.", 45: "ЁЯМ╛ рдЧрд╣реВ: рдЦрдд рдорд╛рддреНрд░рд╛ рджреНрдпрд╛.", 80: "ЁЯМ╛ рдЧрд╣реВ: рджрд╛рдгреЗ рднрд░рддрд╛рдирд╛ рдкрд╛рдгреА." },
    "tur": { 60: "тЬВя╕П рддреВрд░: рд╢реЗрдВрдбрд╛ рдЦреБрдбрдгреА рдХрд░рд╛.", 100: "ЁЯМ╕ рддреВрд░: рдлреБрд▓реЛрд░рд╛ рдХреАрдб рдирд┐рдпрдВрддреНрд░рдг." }
};

function loadCrops() {
    const s = document.getElementById('seasonSelect').value;
    const c = document.getElementById('cropSelect');
    c.innerHTML = '';
    
    let list = [];
    if(s === "KHARIF") list = ["cotton", "soybean", "rice", "tur"];
    else if(s === "RABI") list = ["wheat", "gram", "onion", "garlic"];
    else if(s === "SUMMER") list = ["watermelon", "muskmelon"];
    else if(s === "OTHER") list = ["chilli", "turmeric"];

    list.forEach(k => c.add(new Option(cropNames[k], k)));
}

function addNewCrop() {
    const crop = document.getElementById('cropSelect').value;
    const date = document.getElementById('plantDate').value;
    if(!crop || !date) { alert("рдХреГрдкрдпрд╛ рд╕рд░реНрд╡ рдорд╛рд╣рд┐рддреА рднрд░рд╛!"); return; }

    let myCrops = JSON.parse(localStorage.getItem("myMultiFarm") || "[]");
    
    // рдПрдХрд╛рдЪ рдкрд┐рдХрд╛рдЪреА рдбрдмрд▓ рдПрдиреНрдЯреНрд░реА рд░реЛрдЦрдгреНрдпрд╛рд╕рд╛рдареА
    if(myCrops.some(item => item.crop === crop)) {
        alert("рд╣реЗ рдкреАрдХ рдЖрдзреАрдЪ рдЬреЛрдбрд▓реЗрд▓реЗ рдЖрд╣реЗ!");
        return;
    }

    myCrops.push({ crop, date, id: Date.now() });
    localStorage.setItem("myMultiFarm", JSON.stringify(myCrops));
    
    // рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдкрд░рд╡рд╛рдирдЧреА рдорд╛рдЧрдгреЗ
    if ("Notification" in window) {
        Notification.requestPermission();
    }
    
    renderCrops();
}

function renderCrops() {
    const list = JSON.parse(localStorage.getItem("myMultiFarm") || "[]");
    const container = document.getElementById('cropsList');
    container.innerHTML = list.length === 0 ? "<p style='text-align:center;'>рдЕрджреНрдпрд╛рдк рдХреЛрдгрддреЗрд╣реА рдкреАрдХ рдЬреЛрдбрд▓реЗрд▓реЗ рдирд╛рд╣реА.</p>" : "";

    list.forEach(item => {
        const today = new Date();
        const start = new Date(item.date);
        const diff = Math.floor((today - start) / 86400000);
        
        let msg = "ЁЯМ┐ рдкрд┐рдХрд╛рдЪреЗ рдирд┐рдпрдорд┐рдд рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рд╛.";
        
        // рдЖрдЬрдЪреНрдпрд╛ рджрд┐рд╡рд╕рд╛рдЪрд╛ рдиреЗрдордХрд╛ рд╕рд▓реНрд▓рд╛ рд╢реЛрдзрдгреЗ
        if(advices[item.crop] && advices[item.crop][diff]) {
            msg = advices[item.crop][diff];
            sendPushNotification(cropNames[item.crop], msg); // рдСрдЯреЛ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди
        } else {
            // рдЬрд╡рд│рдЪрд╛ рдорд╛рдЧреАрд▓ рд╕рд▓реНрд▓рд╛ рджрд╛рдЦрд╡рдгреЗ
            let days = Object.keys(advices[item.crop] || {}).filter(d => d <= diff).sort((a,b) => b-a);
            if(days.length > 0) msg = advices[item.crop][days[0]];
        }

        container.innerHTML += `
            <div class="crop-item">
                <button class="delete-btn" onclick="deleteCrop(${item.id})">├Ч</button>
                <strong>ЁЯМ╛ ${cropNames[item.crop]}</strong> <span style="font-size: 12px; color: #666;">(рджрд┐рд╡рд╕: ${diff})</span>
                <div class="advice-text">ЁЯУв ${msg}</div>
            </div>
        `;
    });
}

function sendPushNotification(title, message) {
    if ("Notification" in window && Notification.permission === "granted") {
        new Notification("рд╢реЗрддреА рд╕рд▓реНрд▓рд╛: " + title, {
            body: message,
            icon: "logo.png" // рддреБрдордЪреНрдпрд╛ ре▓рдкрдЪрд╛ рд▓реЛрдЧреЛ рдкрд╛рде рдЗрдереЗ рдЯрд╛рдХрд╛
        });
    }
}

function deleteCrop(id) {
    if(confirm("рд╣реЗ рдкреАрдХ рдпрд╛рджреАрддреВрди рдХрд╛рдврд╛рдпрдЪреЗ рдХрд╛?")) {
        let myCrops = JSON.parse(localStorage.getItem("myMultiFarm") || "[]");
        myCrops = myCrops.filter(c => c.id !== id);
        localStorage.setItem("myMultiFarm", JSON.stringify(myCrops));
        renderCrops();
    }
}

window.onload = renderCrops;
</script>
</body>
</html>

