<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>рдорд╛рдЭрдВ рд╢реЗрдд - рд╕реНрдорд╛рд░реНрдЯ рд╕рд▓реНрд▓рд╛рдЧрд╛рд░</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #2e7d32; text-align: center; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; color: #333; }
        select, input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 15px; background: #2e7d32; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        button:hover { background: #1b5e20; }
        #autoAdviceBox { margin-top: 25px; }
        .advice-card { background: #e8f5e9; padding: 15px; border-radius: 12px; border-left: 6px solid #2e7d32; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .day-count { font-size: 14px; color: #666; font-weight: bold; }
        .advice-text { font-size: 16px; color: #1b5e20; margin-top: 8px; line-height: 1.5; }
        .reset-btn { background: #f44336; margin-top: 20px; font-size: 14px; padding: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ЁЯЪЬ рдорд╛рдЭрдВ рд╕реНрдорд╛рд░реНрдЯ рд╢реЗрдд</h2>
    
    <div id="setupForm">
        <div class="form-group">
            <label>рез. рдЪрд╛рд▓реВ рд╣рдВрдЧрд╛рдо рдирд┐рд╡рдбрд╛</label>
            <select id="seasonSelect" onchange="updateCropList()">
                <option value="">-- рдирд┐рд╡рдбрд╛ --</option>
                <option value="KHARIF_SEASON">ЁЯМзя╕П рдЦрд░реАрдк рд╣рдВрдЧрд╛рдо</option>
                <option value="RABI_SEASON">тЭДя╕П рд░рдмреНрдмреА рд╣рдВрдЧрд╛рдо</option>
                <option value="SUMMER_SEASON">тШАя╕П рдЙрдиреНрд╣рд╛рд│реА рд╣рдВрдЧрд╛рдо</option>
                <option value="CHARA_MASALE">ЁЯМ┐ рдЪрд╛рд░рд╛ рд╡ рдорд╕рд╛рд▓реЗ рдкрд┐рдХреЗ</option>
            </select>
        </div>

        <div class="form-group">
            <label>реи. рддреБрдордЪрдВ рдкреАрдХ рдирд┐рд╡рдбрд╛</label>
            <select id="cropSelect">
                <option value="">рдЖрдзреА рд╣рдВрдЧрд╛рдо рдирд┐рд╡рдбрд╛</option>
            </select>
        </div>

        <div class="form-group">
            <label>рей. рд▓рд╛рдЧрд╡рдбреАрдЪреА рддрд╛рд░реАрдЦ</label>
            <input type="date" id="plantDate">
        </div>

        <button onclick="startSmartAdvisor()">ЁЯЪА рд╕реНрдорд╛рд░реНрдЯ рд╕рд▓реНрд▓рд╛ рд╕реБрд░реВ рдХрд░рд╛</button>
    </div>

    <div id="autoAdviceBox"></div>
    
    <div id="actionArea" style="display:none;">
        <button class="reset-btn" onclick="resetFarmData()">ЁЯФД рдорд╛рд╣рд┐рддреА рдмрджрд▓рд╛ / рд░реАрд╕реЗрдЯ рдХрд░рд╛</button>
    </div>
</div>

<script>
    // рдЯреАрдк: рдпреЗрдереЗ рддреЛ рдореЛрдард╛ masterData (JSON) рдкреЗрд╕реНрдЯ рдХрд░рд╛ рдЬреЛ рдореА рдЖрдзреА рджрд┐рд▓рд╛ рд╣реЛрддрд╛.
    // рдореА рдирдореБрдиреНрдпрд╛рд╕рд╛рдареА рдЦрд╛рд▓реА рдкреБрдиреНрд╣рд╛ рдереЛрдбрд╛ рджрд┐рд▓рд╛ рдЖрд╣реЗ.

    const masterData = {
        "KHARIF_SEASON": { "Groups": { "cotton": { "name": "рдХрд╛рдкреВрд╕", "day_30": "ЁЯМ▒ рдЦрдд рдорд╛рддреНрд░рд╛ рджреНрдпрд╛.", "day_55": "тЪая╕П рдмреЛрдВрдбрдЕрд│реАрд╕рд╛рдареА рд╕рд╛рдкрд│реЗ рд▓рд╛рд╡рд╛." }, "soybean": { "name": "рд╕реЛрдпрд╛рдмреАрди", "day_20": "ЁЯМ┐ рддрдг рдирд┐рдпрдВрддреНрд░рдг рдХрд░рд╛.", "day_45": "ЁЯМ╕ рдлреБрд▓рдзрд╛рд░рдгрд╛ рдЕрд╡рд╕реНрдерд╛." } } },
        "RABI_SEASON": { "Groups": { "wheat": { "name": "рдЧрд╣реВ", "day_21": "ЁЯТз рдкрд╣рд┐рд▓реЗ рдкрд╛рдгреА рджреНрдпрд╛.", "day_65": "ЁЯМ╛ рдХрд╛рдВрдбреА рдзрд░рддрд╛рдирд╛ рдкрд╛рдгреА рджреНрдпрд╛." } } },
        "SUMMER_SEASON": { "Groups": { "watermelon": { "name": "рдХрд▓рд┐рдВрдЧрдб", "day_30": "ЁЯНЙ рдлрд│ рдлреБрдЧрд╡рдгреАрд╕рд╛рдареА рдЦрдд рджреНрдпрд╛." } } },
        "CHARA_MASALE": { "Groups": { "turmeric": { "name": "рд╣рд│рдж", "day_90": "ЁЯЪЬ рднрд░рдгреА (рдорд╛рддреА рдЪрдврд╡рдгреЗ) рдХрд░рд╛." } } }
    };

    function updateCropList() {
        const season = document.getElementById('seasonSelect').value;
        const cropDropdown = document.getElementById('cropSelect');
        cropDropdown.innerHTML = '<option value="">-- рдкреАрдХ рдирд┐рд╡рдбрд╛ --</option>';
        if (masterData[season]) {
            Object.keys(masterData[season].Groups).forEach(cropKey => {
                let option = new Option(masterData[season].Groups[cropKey].name, cropKey);
                cropDropdown.add(option);
            });
        }
    }

    function startSmartAdvisor() {
        const season = document.getElementById('seasonSelect').value;
        const cropKey = document.getElementById('cropSelect').value;
        const date = document.getElementById('plantDate').value;
        if (!season || !cropKey || !date) { alert("рдХреГрдкрдпрд╛ рд╕рд░реНрд╡ рдорд╛рд╣рд┐рддреА рднрд░рд╛!"); return; }
        
        const userData = { season, cropKey, date };
        localStorage.setItem("userFarmData", JSON.stringify(userData));
        showAdvice();
    }

    function showAdvice() {
        const saved = JSON.parse(localStorage.getItem("userFarmData"));
        const adviceBox = document.getElementById("autoAdviceBox");
        const setupForm = document.getElementById("setupForm");
        const actionArea = document.getElementById("actionArea");

        if (!saved) return;

        setupForm.style.display = "none"; // рдлреЙрд░реНрдо рд▓рдкрд╡рд╛
        actionArea.style.display = "block"; // рд░реАрд╕реЗрдЯ рдмрдЯрдг рджрд╛рдЦрд╡рд╛

        const today = new Date();
        const start = new Date(saved.date);
        const diffDays = Math.floor((today - start) / (1000 * 60 * 60 * 24));

        let advice = "ЁЯМ┐ рдкрд┐рдХрд╛рдЪреА рд╕реНрдерд┐рддреА рдЙрддреНрддрдо рдЖрд╣реЗ. рдирд┐рдпрдорд┐рдд рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рд╛.";
        const cropGroup = masterData[saved.season].Groups[saved.cropKey];

        // рдЬрд╡рд│рдЪрд╛ рд╕рд▓реНрд▓рд╛ рд╢реЛрдзрдгреЗ
        let daysKeys = Object.keys(cropGroup).filter(k => k.startsWith('day_')).map(k => parseInt(k.split('_')[1]));
        let pastDays = daysKeys.filter(d => d <= diffDays).sort((a,b) => b-a);
        if(pastDays.length > 0) { advice = cropGroup["day_" + pastDays[0]]; }

        adviceBox.innerHTML = `
            <div class="advice-card">
                <div class="day-count">ЁЯУЕ рдЖрдЬ рд▓рд╛рдЧрд╡рдбреАрдЪрд╛ ${diffDays} рд╡рд╛ рджрд┐рд╡рд╕ рдЖрд╣реЗ (${cropGroup.name})</div>
                <div class="advice-text"><strong>ЁЯУв рдЖрдЬрдЪрд╛ рд╕рд▓реНрд▓рд╛:</strong> ${advice}</div>
            </div>
        `;
    }

    function resetFarmData() {
        if(confirm("рддреБрдореНрд╣рд╛рд▓рд╛ рдорд╛рд╣рд┐рддреА рдмрджрд▓рд╛рдпрдЪреА рдЖрд╣реЗ рдХрд╛?")) {
            localStorage.removeItem("userFarmData");
            location.reload();
        }
    }

    window.onload = showAdvice;
</script>

</body>
</html>
