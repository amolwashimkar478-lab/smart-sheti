<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä - ‡§ë‡§ü‡•ã ‡§Ö‡§≤‡§∞‡•ç‡§ü</title>
    <style>
        :root { --whatsapp-green: #25D366; --dark-green: #075E54; }
        body { font-family: 'Arial', sans-serif; background: #e5ddd5; margin: 0; padding: 10px; }
        .app-bar { background: var(--dark-green); color: white; padding: 15px; text-align: center; font-size: 20px; font-weight: bold; border-radius: 0 0 15px 15px; margin-bottom: 15px; }
        .add-box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .crop-card { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 5px solid var(--whatsapp-green); box-shadow: 0 1px 3px rgba(0,0,0,0.2); position: relative; }
        .crop-name { font-size: 18px; font-weight: bold; color: var(--dark-green); }
        .advice-msg { background: #dcf8c6; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 14px; position: relative; }
        .advice-msg::after { content: ''; position: absolute; left: -10px; top: 10px; border-width: 5px 10px 5px 0; border-style: solid; border-color: transparent #dcf8c6 transparent transparent; }
        .btn-save { background: var(--whatsapp-green); color: white; border: none; padding: 12px; width: 100%; border-radius: 5px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .btn-home { background: #34b7f1; color: white; text-align: center; padding: 12px; border-radius: 5px; display: block; text-decoration: none; margin-top: 20px; font-weight: bold; }
        .del-icon { position: absolute; top: 10px; right: 10px; color: red; cursor: pointer; font-size: 20px; }
    </style>
</head>
<body>

<div class="app-bar">üöú ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§Ö‡§≤‡§∞‡•ç‡§ü</div>

<div class="add-box">
    <strong>‚ûï ‡§®‡§µ‡•Ä‡§® ‡§™‡•Ä‡§ï ‡§®‡•ã‡§Ç‡§¶‡§µ‡§æ (‡§ï‡§Æ‡§æ‡§≤ ‡•™)</strong>
    <select id="seasonSelect" onchange="syncCrops()" style="width:100%; padding:10px; margin: 10px 0;">
        <option value="">‡§π‡§Ç‡§ó‡§æ‡§Æ ‡§®‡§ø‡§µ‡§°‡§æ</option>
        <option value="kh">‡§ñ‡§∞‡•Ä‡§™</option>
        <option value="rb">‡§∞‡§¨‡•ç‡§¨‡•Ä</option>
        <option value="sm">‡§â‡§®‡•ç‡§π‡§æ‡§≥‡•Ä</option>
    </select>
    <select id="cropSelect" style="width:100%; padding:10px; margin-bottom:10px;"></select>
    <input type="date" id="plantDate" style="width:100%; padding:10px; box-sizing: border-box;">
    <button class="btn-save" onclick="addCrop()">‡§µ‡•á‡§≥‡§æ‡§™‡§§‡•ç‡§∞‡§ï ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ</button>
</div>

<div id="cropList"></div>

<a href="home.html" class="btn-home">üè† ‡§π‡•ã‡§Æ‡§µ‡§∞ ‡§ú‡§æ</a>

<script>
// ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏
const crops = {
    "kh": { "cotton": "‡§ï‡§æ‡§™‡•Ç‡§∏", "soybean": "‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®", "tur": "‡§§‡•Ç‡§∞" },
    "rb": { "wheat": "‡§ó‡§π‡•Ç", "gram": "‡§π‡§∞‡§≠‡§∞‡§æ", "onion": "‡§ï‡§æ‡§Ç‡§¶‡§æ" }
};

const schedules = {
    "cotton": { 30: "‡§ñ‡§§ ‡§¶‡•á‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§µ‡•á‡§≥ ‡§ù‡§æ‡§≤‡•Ä ‡§Ü‡§π‡•á!", 50: "‡§¨‡•ã‡§Ç‡§°‡§Ö‡§≥‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§∏‡§æ‡§™‡§≥‡•á ‡§§‡§™‡§æ‡§∏‡§æ.", 80: "‡§Ü‡§ú ‡§´‡§µ‡§æ‡§∞‡§£‡•Ä‡§ö‡•á ‡§®‡§ø‡§Ø‡•ã‡§ú‡§® ‡§ï‡§∞‡§æ." },
    "soybean": { 20: "‡§§‡§£‡§®‡§æ‡§∂‡§ï ‡§´‡§µ‡§æ‡§∞‡§£‡•Ä ‡§ï‡§∞‡§æ.", 45: "‡§´‡•Å‡§≤‡§ß‡§æ‡§∞‡§£‡•á‡§∏‡§æ‡§†‡•Ä ‡§™‡§æ‡§£‡•Ä ‡§¶‡•ç‡§Ø‡§æ.", 75: "‡§∂‡•á‡§Ç‡§ó‡§æ ‡§≠‡§∞‡§§‡§æ‡§®‡§æ ‡§ï‡•Ä‡§° ‡§§‡§™‡§æ‡§∏‡§æ." },
    "wheat": { 21: "‡§Ü‡§ú ‡§™‡§π‡§ø‡§≤‡•á ‡§™‡§æ‡§£‡•Ä (‡§Æ‡•Å‡§ï‡•Å‡§ü‡§Æ‡•Å‡§≥‡•á) ‡§¶‡•ç‡§Ø‡§æ.", 45: "‡§¶‡•Å‡§∏‡§∞‡§æ ‡§π‡§™‡•ç‡§§‡§æ ‡§ñ‡§§ ‡§¶‡•ç‡§Ø‡§æ." }
};

function syncCrops() {
    const s = document.getElementById('seasonSelect').value;
    const c = document.getElementById('cropSelect');
    c.innerHTML = '';
    if(crops[s]) Object.entries(crops[s]).forEach(([k,v]) => c.add(new Option(v,k)));
}

function addCrop() {
    let myFarm = JSON.parse(localStorage.getItem("smartFarm") || "[]");
    if(myFarm.length >= 4) return alert("‡§Æ‡§∞‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§∏‡§Ç‡§™‡§≤‡•Ä!");

    const crop = document.getElementById('cropSelect').value;
    const date = document.getElementById('plantDate').value;
    if(!crop || !date) return alert("‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§≠‡§∞‡§æ!");

    myFarm.push({ id: Date.now(), crop, date });
    localStorage.setItem("smartFarm", JSON.stringify(myFarm));
    
    // ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§™‡§∞‡§µ‡§æ‡§®‡§ó‡•Ä ‡§Æ‡§æ‡§ó‡§£‡•á
    Notification.requestPermission();
    
    render();
}

function render() {
    const myFarm = JSON.parse(localStorage.getItem("smartFarm") || "[]");
    const container = document.getElementById('cropList');
    container.innerHTML = '';

    myFarm.forEach(item => {
        const diff = Math.floor((new Date() - new Date(item.date)) / 86400000);
        const name = Object.values(crops).reduce((a,b) => b[item.crop] || a, "");
        
        let msg = "‡§Ü‡§ú ‡§™‡•Ä‡§ï ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£‡§æ‡§ö‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§æ.";
        if(schedules[item.crop] && schedules[item.crop][diff]) {
            msg = schedules[item.crop][diff];
            // ‡§µ‡•ç‡§π‡•â‡§ü‡•ç‡§∏‡§Ö‡§Å‡§™ ‡§∏‡•ç‡§ü‡§æ‡§à‡§≤ ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞
            triggerPush(name, msg);
        } else {
            let past = Object.keys(schedules[item.crop] || {}).filter(d => d <= diff).sort((a,b)=>b-a);
            if(past.length > 0) msg = schedules[item.crop][past[0]];
        }

        container.innerHTML += `
            <div class="crop-card">
                <span class="del-icon" onclick="removeCrop(${item.id})">√ó</span>
                <div class="crop-name">üåæ ${name}</div>
                <div style="font-size:12px; color:#666;">‡§≤‡§æ‡§ó‡§µ‡§°‡•Ä‡§ö‡§æ ${diff} ‡§µ‡§æ ‡§¶‡§ø‡§µ‡§∏</div>
                <div class="advice-msg">üí¨ ${msg}</div>
            </div>
        `;
    });
}

function triggerPush(cropName, message) {
    if (Notification.permission === "granted") {
        new Notification("üåæ ‡§∂‡•á‡§§‡•Ä ‡§∏‡§≤‡•ç‡§≤‡§æ: " + cropName, {
            body: message,
            icon: "https://cdn-icons-png.flaticon.com/512/2153/2153047.png", // ‡§∂‡•á‡§§‡•Ä‡§ö‡§æ ‡§Ü‡§Ø‡§ï‡•â‡§®
            vibrate: [200, 100, 200]
        });
    }
}

function removeCrop(id) {
    let myFarm = JSON.parse(localStorage.getItem("smartFarm") || "[]").filter(c => c.id !== id);
    localStorage.setItem("smartFarm", JSON.stringify(myFarm));
    render();
}

// ‡§¶‡§∞ ‡•ß ‡§§‡§æ‡§∏‡§æ‡§®‡•á ‡§ë‡§ü‡•ã-‡§ö‡•á‡§ï ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä (‡•≤‡§™ ‡§â‡§ò‡§°‡•á ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏)
setInterval(render, 3600000); 

window.onload = render;
</script>
</body>
</html>
