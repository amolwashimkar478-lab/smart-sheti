<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Sheti - Login</title>

<!-- Adsense (OK) -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8832195992833438"
crossorigin="anonymous"></script>

<link rel="manifest" href="/manifest.json">

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: Segoe UI, sans-serif;
  background: linear-gradient(135deg, #e8f5e9, #a5d6a7);
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.box {
  background: #fff;
  width: 350px;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  text-align: center;
}
h2 { color: #2e7d32; margin-bottom: 20px; }
input {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 8px;
  border: 1px solid #ddd;
}
button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 8px;
  font-weight: bold;
  border: none;
  cursor: pointer;
}
.btn-login { background: #2e7d32; color: white; }
.btn-google {
  background: white;
  border: 1px solid #ddd;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}
.link {
  margin-top: 10px;
  color: #2e7d32;
  cursor: pointer;
  font-size: 14px;
}
hr { margin: 20px 0; }
</style>
</head>

<body>

<div class="box">
  <h2>üå± Smart Sheti</h2>

  <input id="email" type="email" placeholder="‡§à‡§Æ‡•á‡§≤">
  <input id="password" type="password" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">

  <button class="btn-login" id="loginBtn">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡§æ</button>

  <div class="link" id="forgotBtn">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§µ‡§ø‡§∏‡§∞‡§≤‡§æ‡§§?</div>
  <div class="link" onclick="location.href='signup.html'">‡§®‡§µ‡•Ä‡§® ‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ? ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä ‡§ï‡§∞‡§æ</div>

  <hr>

  <button class="btn-google" id="googleBtn">
    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
    Google ‡§∏‡§π ‡§™‡•Å‡§¢‡•á ‡§ú‡§æ
  </button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  signInWithEmailAndPassword,
  signInWithRedirect,
  getRedirectResult,
  sendPasswordResetEmail,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* üî• Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyA1M7dJ9KFVe1GAGWPPqLuAT7BEuIKsZkM",
  authDomain: "smart-sheti-6512e.firebaseapp.com",
  projectId: "smart-sheti-6512e",
  storageBucket: "smart-sheti-6512e.appspot.com",
  messagingSenderId: "1086459599128",
  appId: "1:1086459599128:web:03a34ed9ea2b95b1ebe66d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

/* ‚úÖ Already logged-in user ‚Üí Home */
onAuthStateChanged(auth, (user) => {
  if (user) {
    window.location.href = "home.html";
  }
});

/* üìß Email Login */
document.getElementById("loginBtn").onclick = () => {
  const email = email.value;
  const password = password.value;
  if (!email || !password) return alert("‡§à‡§Æ‡•á‡§≤ ‡§Ü‡§£‡§ø ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ü‡§æ‡§ï‡§æ");

  signInWithEmailAndPassword(auth, email, password)
    .then(() => window.location.href = "home.html")
    .catch(err => alert(err.message));
};

/* üîµ Google Login (Redirect ‚Äì popup problem fix) */
document.getElementById("googleBtn").onclick = () => {
  signInWithRedirect(auth, provider);
};

/* üîÑ Handle redirect result */
getRedirectResult(auth)
  .then((result) => {
    if (result?.user) {
      window.location.href = "home.html";
    }
  })
  .catch(err => console.log(err));

/* üîê Password Reset */
document.getElementById("forgotBtn").onclick = () => {
  const emailVal = email.value;
  if (!emailVal) return alert("‡§à‡§Æ‡•á‡§≤ ‡§ü‡§æ‡§ï‡§æ");
  sendPasswordResetEmail(auth, emailVal)
    .then(() => alert("Reset ‡§≤‡§ø‡§Ç‡§ï ‡§™‡§æ‡§†‡§µ‡§≤‡•Ä ‡§Ü‡§π‡•á"))
    .catch(err => alert(err.message));
};
</script>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js');
}
</script>

</body>
</html>
