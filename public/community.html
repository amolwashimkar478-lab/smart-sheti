<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Sheti - Q&A Community</title>

<!-- OneSignal SDK -->
<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

<style>
:root {
    --primary-color: #2e7d32;
    --card-bg: #ffffff;
    --bg-color: #f0f2f5;
    --text-color: #1c1e21;
    --border-color: #ddd;
}
body.dark-theme {
    --bg-color: #121212;
    --card-bg: #1e1e1e;
    --text-color: #e4e6eb;
    --border-color: #333;
}
body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); margin:0; padding:0; transition:0.3s; color: var(--text-color); }
.header { background: var(--primary-color); color:white; padding:15px; display:flex; justify-content:space-between; align-items:center; }
.header h1 { margin:0; font-size:20px; }
.header .theme-toggle { cursor:pointer; }
.container { max-width:600px; margin:20px auto; padding:0 10px; }
.search-bar { width:100%; padding:12px; border-radius:12px; border:1px solid var(--border-color); margin-bottom:15px; font-size:16px; box-sizing:border-box; outline:none; }
.card { background: var(--card-bg); padding:15px; border-radius:15px; margin-bottom:15px; box-shadow:0 2px 8px rgba(0,0,0,0.05); }
.card h3 { margin:0 0 8px 0; font-size:16px; }
.card p { margin:5px 0; }
.actions { display:flex; gap:10px; margin-top:10px; }
.actions button { padding:6px 10px; font-size:12px; border-radius:8px; border:none; cursor:pointer; }
.btn-like { background:#43a047; color:white; }
.btn-report { background:#f44336; color:white; }
.btn-voice { background:#1565c0; color:white; }
.top-helpers { background: var(--card-bg); border-radius:15px; padding:10px; margin-bottom:15px; }
.top-helpers h4 { margin:0 0 8px 0; font-size:14px; }
.top-helpers ul { margin:0; padding:0; list-style:none; }
.top-helpers li { padding:4px 0; border-bottom:1px solid var(--border-color); }
.new-question { display:flex; gap:10px; margin-bottom:15px; }
.new-question input { flex:1; padding:12px; border-radius:12px; border:1px solid var(--border-color); }
.new-question button { padding:12px; border-radius:12px; border:none; background: var(--primary-color); color:white; cursor:pointer; }
</style>
</head>
<body>

<div class="header">
    <h1>üåæ Smart Sheti Community</h1>
    <span class="theme-toggle" onclick="toggleTheme()">üåì</span>
</div>

<div class="container">
    <input type="text" id="searchBar" class="search-bar" placeholder="‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∂‡•ã‡§ß‡§æ..." onkeyup="filterQuestions()">
    <div class="top-helpers">
        <h4>üìä Top Helpers</h4>
        <ul id="helpersList"></ul>
    </div>
    <div class="new-question">
        <input type="text" id="newQuestionInput" placeholder="‡§§‡•Å‡§Æ‡§ö‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ü‡§æ‡§ï‡§æ...">
        <button onclick="addQuestion()">‚ùì</button>
    </div>
    <div id="questionsContainer"></div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyA1M7dJ9KFVe1GAGWPPqLuAT7BEuIKsZkM",
    authDomain: "smart-sheti-6512e.firebaseapp.com",
    databaseURL: "https://smart-sheti-6512e-default-rtdb.firebaseio.com",
    projectId: "smart-sheti-6512e",
    storageBucket: "smart-sheti-6512e.firebasestorage.app",
    messagingSenderId: "1086459599128",
    appId: "1:1086459599128:web:03a34ed9ea2b95b1ebe66d"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const questionsRef = ref(db, "community_questions");

// Real-time listener
onValue(questionsRef, (snapshot)=>{
    const data = snapshot.val();
    if(!data) return;
    questions = Object.keys(data).map(k => ({id:k, ...data[k]})).sort((a,b)=>b.timestamp-a.timestamp);
    renderQuestions();
});

</script>

<script>
let questions = [];
let helpers = [
    {name:"Ramesh", score:10},
    {name:"Sita", score:8},
    {name:"Ganesh", score:5},
];

// OneSignal init
window.OneSignal = window.OneSignal || [];
OneSignal.push(function(){
    OneSignal.init({
        appId: "fdb7e40a-dc5c-4620-85d7-d99e5db6eb91"
    });
});

// Render helpers
function renderHelpers() {
    const list = document.getElementById("helpersList");
    list.innerHTML="";
    helpers.sort((a,b)=>b.score-a.score).forEach(h=>{
        const li=document.createElement("li");
        li.textContent=`${h.name} - ${h.score} points`;
        list.appendChild(li);
    });
}

// Render questions
function renderQuestions() {
    const container = document.getElementById("questionsContainer");
    container.innerHTML="";
    questions.forEach(q=>{
        const card=document.createElement("div");
        card.className="card";
        card.dataset.id=q.id;
        card.innerHTML=`
            <h3>${q.question} ${q.expert?"üë®‚Äçüåæ":""}</h3>
            <p>${(q.answers||[]).join("<br>")}</p>
            <div class="actions">
                <button class="btn-like" onclick="likeQuestion('${q.id}')">üëç Like (${q.likes||0})</button>
                <button class="btn-report" onclick="reportQuestion('${q.id}')">üö® Report (${q.reports||0})</button>
            </div>
        `;
        container.appendChild(card);
    });
}

// Add question
function addQuestion(){
    const input = document.getElementById("newQuestionInput");
    const text = input.value.trim();
    if(!text) return;
    const newQ = {question:text, answers:[], likes:0, reports:0, timestamp:Date.now(), expert:false};
    push(ref(firebase.database(), "community_questions"), newQ)
        .then(()=>{
            input.value="";
            // Send push notification
            OneSignal.push(function(){
                OneSignal.sendSelfNotification(
                    "üì¢ ‡§®‡§µ‡•Ä‡§® ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡•á‡§≤‡•á!",
                    text,
                    "https://yoursite.com",
                    null,
                    {action:"view-question"}
                );
            });
        });
}

// Like & Report (local only)
function likeQuestion(id){ const q=questions.find(x=>x.id===id); if(q) q.likes=(q.likes||0)+1; renderQuestions(); }
function reportQuestion(id){ const q=questions.find(x=>x.id===id); if(q) q.reports=(q.reports||0)+1; renderQuestions(); }

// Filter
function filterQuestions(){
    const val=document.getElementById("searchBar").value.toLowerCase();
    questions.filter(q=>q.question.toLowerCase().includes(val)).forEach(q=>{}); // optional: filter UI
}

// Theme toggle
function toggleTheme(){ document.body.classList.toggle("dark-theme"); }

// Init
renderHelpers();
renderQuestions();
</script>

</body>
</html>
