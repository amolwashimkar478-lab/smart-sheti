<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Sheti - Home</title>

<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "fdb7e40a-dc5c-4620-85d7-d99e5db6eb91",
      allowLocalhostAsSecureOrigin: true,
      slidedown: {
        prompts: [
          {
            type: "push",
            autoPrompt: true, 
            text: {
              actionMessage: "рддреБрдореНрд╣рд╛рд▓рд╛ рд╢реЗрддреАрд╡рд┐рд╖рдпрдХ рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рд╕реВрдЪрдирд╛ рдЖрдгрд┐ рдкрд╛рд╡рд╕рд╛рдЪрд╛ рдЗрд╢рд╛рд░рд╛ рдорд┐рд│рд╡рд╛рдпрдЪрд╛ рдЖрд╣реЗ рдХрд╛?",
              acceptButton: "рд╣реЛ, Allow рдХрд░рд╛",
              cancelButton: "рдирдХреЛ, Deny рдХрд░рд╛"
            },
            delay: { pageViews: 1, timeDelay: 3 }
          }
        ]
      }
    });
  });

  async function checkWeatherAndNotify() {
      const weatherKey = "4e520dcafeb783757272573493f6a2d3";
      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(async (position) => {
              const lat = position.coords.latitude;
              const lon = position.coords.longitude;
              try {
                  const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${weatherKey}&units=metric`);
                  const data = await response.json();
                  if (data.weather[0].main === "Rain" || data.weather[0].main === "Drizzle") {
                      window.OneSignalDeferred.push(function(OneSignal) {
                          OneSignal.Notifications.displaySelfClickableNotification(
                              "ЁЯМзя╕П рдлрд╡рд╛рд░рдгреА рдЗрд╢рд╛рд░рд╛", 
                              `рд╕рдзреНрдпрд╛ рддреБрдордЪреНрдпрд╛ рдкрд░рд┐рд╕рд░рд╛рдд (${data.name}) рдкрд╛рдКрд╕ рджрд┐рд╕рдд рдЖрд╣реЗ. рдХреГрдкрдпрд╛ рдлрд╡рд╛рд░рдгреА рдЯрд╛рд│рд╛.`,
                              "https://smart-sheti.vercel.app/"
                          );
                      });
                  }
              } catch (e) { console.log("Weather error"); }
          });
      }
  }
  setTimeout(checkWeatherAndNotify, 5000);
</script>

<style>
:root {
  --bg-color: #e8f5e9;
  --header-bg: #ffffff;
  --text-color: #2e7d32;
}
body.dark-theme {
  --bg-color: #121212;
  --header-bg: #1e1e1e;
  --text-color: #81c784;
}
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: var(--bg-color);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
  margin: 0;
  transition: 0.3s;
}

/* Header with logo + 2 icons */
.header {
  width: 100%;
  max-width: 400px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 25px;
  padding: 16px 18px;   /* рдереЛрдбрд╛ padding рд╡рд░реВрди рд▓реБрдХ рдЙрдареВрди рджрд┐рд╕реЗрд▓ */
  background: var(--header-bg);
  border-radius: 18px;  /* рдереЛрдбрд╛ рдЧреЛрд▓ effect */
  box-shadow: 0 6px 16px rgba(0,0,0,0.15);  /* рдЙрдареВрди рджрд┐рд╕реЗрд▓ */
  box-sizing: border-box;
}

.logo {
  font-size: 22px;
  font-weight: bold;
  color: var(--text-color);
}

.header-actions {
  display: flex;
  gap: 12px;
}

.action-circle {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: 0.2s;
  background: white;
  border: 1.5px solid #2e7d32;
}

.action-circle:active { transform: scale(0.9); }

.btn {
  width: 100%;
  max-width: 300px;
  padding: 14px 16px;
  margin: 8px 0;
  font-size: 17px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  color: white;
  box-shadow: 0 4px 8px rgba(0,0,0,0.12);
  transition: 0.3s;
}

.btn:active { transform: scale(0.98); }

/* Buttons Colors */
.weather-btn { background: #1565c0; }
.spray-btn { background: #00796b; } 
.ai-btn { background: #2e7d32; }
.notify-btn { background: #ef6c00; }
.market-btn { background-color: #2e7d32 !important; }

.calc-btn { background: linear-gradient(135deg, #2e7d32, #43a047); font-weight: bold; padding: 16px; }
.schedule-btn { background: linear-gradient(135deg, #ef6c00, #fb8c00); font-weight: bold; padding: 16px; }
.satbara-btn { background: linear-gradient(135deg, #004d40, #00695c); }

</style>
</head>

<body>

<div class="header">
  <div class="logo">ЁЯМ╛ Smart Sheti</div>
  
  <div class="header-actions">
    <div class="action-circle" style="background: #ffd700;" onclick="location.href='kharch-diary.html'">
      ЁЯТ░
    </div>
    <div class="action-circle" onclick="location.href='setting.html'">
      тЪЩя╕П
    </div>
  </div>
</div>

<button class="btn weather-btn" onclick="location.href='weather.html'">ЁЯМж рдЖрдЬрдЪрдВ рд╣рд╡рд╛рдорд╛рди</button>
<button class="btn spray-btn" onclick="checkWeatherForSpray()">ЁЯЪ┐ рдлрд╡рд╛рд░рдгреА рд╕рд▓реНрд▓рд╛ (Rain Check)</button>
<button class="btn ai-btn" onclick="location.href='ai.html'">ЁЯдЦ AI рддрдЬреНрдЬреНрдЮ рд╕рд▓реНрд▓рд╛</button>
<button class="btn ai-btn" onclick="location.href='disease.html'">ЁЯУ╕ рд░реЛрдЧ рдУрд│рдЦ (рдлреЛрдЯреЛ рдХрд╛рдврд╛)</button>
<button class="btn ai-btn" onclick="location.href='crop-calendar.html'">ЁЯМ▒ рдкреАрдХ рд╡реЗрд│рд╛рдкрддреНрд░рдХ</button>
<button class="btn notify-btn" onclick="location.href='news.html'">ЁЯУ░ рд╢реЗрддреА рдмрд╛рддрдореНрдпрд╛</button>
<button class="btn notify-btn" onclick="triggerPushPrompt()">ЁЯФФ рдкрд╛рдКрд╕ рдЕрд▓рд░реНрдЯ рдЪрд╛рд▓реВ рдХрд░рд╛</button>
<button class="btn market-btn" onclick="location.href='market.html'"><span class="icon">ЁЯУИ</span> рдЖрдЬрдЪреЗ рдмрд╛рдЬрд╛рд░рднрд╛рд╡</button>

<button class="btn calc-btn" onclick="location.href='calculator.html'">ЁЯзк рдЦрдд рдХреЕрд▓реНрдХреНрдпреБрд▓реЗрдЯрд░ (A-Z)</button>
<button class="btn schedule-btn" onclick="location.href='spray-schedule.html'">ЁЯЪЬ рдлрд╡рд╛рд░рдгреА рд╡реЗрд│рд╛рдкрддреНрд░рдХ (A-Z)</button>

<button class="btn satbara-btn" onclick="window.open('https://digitalsatbara.mahabhumi.gov.in/', '_blank')">ЁЯУД рдбрд┐рдЬрд┐рдЯрд▓ рд╕рд╛рддрдмрд╛рд░рд╛ / реордЕ</button>
<button class="btn" onclick="window.open('https://pmfby.gov.in/', '_blank')" style="background: #607d8b;">ЁЯУС рдкреАрдХ рд╡рд┐рдорд╛ рд╕реНрдЯреЗрдЯрд╕</button>
<button class="btn" onclick="window.open('https://pmkisan.gov.in/BeneficiaryStatus_New.aspx', '_blank')" style="background: #546e7a;">ЁЯТ╕ PM-Kisan рд╣рдкреНрддрд╛ рдЪреЗрдХ</button>

<script>
window.onload = () => {
  if (localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark-theme');
  }
};

function triggerPushPrompt() {
  window.OneSignalDeferred.push(function(OneSignal) {
    OneSignal.Slidedown.promptPush();
  });
}

function checkWeatherForSpray() {
  if (!navigator.geolocation) { alert("рд▓реЛрдХреЗрд╢рди рд╕рдкреЛрд░реНрдЯ рдирд╛рд╣реА."); return; }
  alert("рд╣рд╡рд╛рдорд╛рди рддрдкрд╛рд╕рдд рдЖрд╣реЗ...");
  navigator.geolocation.getCurrentPosition(async (pos) => {
    const { latitude, longitude } = pos.coords;
    try {
      const weatherKey = "4e520dcafeb783757272573493f6a2d3";
      const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${weatherKey}&units=metric`);
      const data = await res.json();
      if (data.weather[0].main === "Rain" || data.weather[0].main === "Drizzle") {
        alert("ЁЯМзя╕П рдкрд╛рдКрд╕ рд╕реБрд░реВ рдЖрд╣реЗ. рдлрд╡рд╛рд░рдгреА рдкреБрдвреЗ рдврдХрд▓рд╛! тЭМ");
      } else {
        alert("тЬЕ рд╣рд╡рд╛рдорд╛рди рд╕рд╛рдл рдЖрд╣реЗ. рддреБрдореНрд╣реА рдлрд╡рд╛рд░рдгреА рдХрд░реВ рд╢рдХрддрд╛. ЁЯМ┐");
      }
    } catch (err) { alert("рдорд╛рд╣рд┐рддреА рдорд┐рд│рд╡рдгреНрдпрд╛рдд рдЕрдбрдЪрдг рдЖрд▓реА."); }
  });
}
</script>

</body>
</html>
