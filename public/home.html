<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Sheti - Home</title>

<script>
  if (!sessionStorage.getItem("isLoggedIn")) {
      document.documentElement.style.display = 'none';
      window.location.replace("index.html");
  }

  // рдЗрддрд┐рд╣рд╛рд╕ рдореЕрдиреЗрдЬ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
  function manageHistory() {
      window.history.pushState({page: 1}, null, window.location.href);
  }
  
  manageHistory();

  // рдпреБрдЬрд░ рдмреЕрдХ рдЬрд╛рдгреНрдпрд╛рдЪрд╛ рдкреНрд░рдпрддреНрди рдХрд░рдд рдЕрд╕рд▓реНрдпрд╛рд╕ рддреНрдпрд╛рд▓рд╛ рд░реЛрдЦреВрди рдзрд░рдгреНрдпрд╛рд╕рд╛рдареА
  window.addEventListener('popstate', function(event) {
      manageHistory(); 
  });
</script>

<script>
if (typeof window !== "undefined" && "serviceWorker" in navigator) {
  var s=document.createElement("script");
  s.src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js";
  s.defer=true;
  document.head.appendChild(s);

  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId:"fdb7e40a-dc5c-4620-85d7-d99e5db6eb91",
      notifyButton:{enable:false},
      allowLocalhostAsSecureOrigin:true
    });
  });
}
</script>

<style>
:root { --bg:#e8f5e9; --head:#fff; --green:#2e7d32; --gold:#D4AF37; }
body{font-family:'Segoe UI';background:var(--bg);margin:0;padding:20px;}
.header{max-width:400px;margin:auto  auto 20px;display:flex;justify-content:space-between;align-items:center;
background:var(--head);padding:16px;border-radius:18px;box-shadow:0 6px 16px rgba(0,0,0,.15);}
.logo{font-size:22px;font-weight:bold;color:var(--green);}
.header-actions{display:flex;gap:12px;}
.action-circle{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;
font-size:20px;background:#fff;border:1.5px solid var(--green);cursor:pointer;}
.btn{width:100%;max-width:320px;margin:10px auto;padding:14px;border:none;border-radius:12px;
font-size:16px;font-weight:bold;color:#fff;display:block;cursor:pointer;}
.weather-btn{background:#1565c0;}
.spray-btn{background:#00796b;}
.ai-btn{background:#2e7d32;}
.notify-btn{background:#ef6c00;}
.market-btn{background:#2e7d32;}
.calc-btn{background:linear-gradient(135deg,#2e7d32,#43a047);}
.schedule-btn{background:linear-gradient(135deg,#ef6c00,#fb8c00);}
.satbara-btn{background:linear-gradient(135deg,#004d40,#00695c);}

/* Exit UI */
#toastMessage {
    position: fixed; bottom: 60px; left: 50%; transform: translateX(-50%);
    background: #333; color: white; padding: 10px 30px; border-radius: 50px;
    font-size: 16px; display: none; z-index: 10000; font-weight: bold;
}
#fullExitScreen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--green); color: white; display: none;
    flex-direction: column; align-items: center; justify-content: center;
    z-index: 10001; text-align: center;
}
.exit-emoji { font-size: 80px; margin-bottom: 20px; }
.exit-text { font-size: 22px; font-weight: bold; padding: 0 20px; line-height: 1.5; }

/* Update Popup */
#updatePopup {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); display: none; align-items: center;
    justify-content: center; z-index: 30000;
}
.popup-content {
    background: white; padding: 25px; border-radius: 20px;
    width: 85%; max-width: 320px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
}
.popup-btn {
    background: var(--green); color: white; border: none; padding: 12px 25px;
    border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; margin-top: 15px;
}
</style>
</head>

<body>

<div id="updatePopup">
    <div class="popup-content">
        <div style="font-size: 40px; margin-bottom: 10px;">тЬи</div>
        <h3 style="color:var(--green); margin:0;">рдирд╡реАрди рдЕрдкрдбреЗрдЯ!</h3>
        <p style="color:#555; font-size:15px; margin:10px 0;">рдЖрдореНрд╣реА ре▓рдкрдордзреНрдпреЗ рдХрд╛рд╣реА рдирд╡реАрди рдмрджрд▓ рдХреЗрд▓реЗ рдЖрд╣реЗрдд. рдЕрдзрд┐рдХ рдЪрд╛рдВрдЧрд▓реНрдпрд╛ рдЕрдиреБрднрд╡рд╛рд╕рд╛рдареА рдЖрддреНрддрд╛рдЪ рддрдкрд╛рд╕рд╛.</p>
        <button class="popup-btn" onclick="closeUpdatePopup()">рдЖрддрд╛рдЪ рд╡рд╛рдкрд░реВрди рдкрд╣рд╛</button>
    </div>
</div>

<div id="toastMessage">Exit тЬЕ</div>
<div id="fullExitScreen">
    <div class="exit-emoji">ЁЯЩП</div>
    <div class="exit-text">рд╕реНрдорд╛рд░реНрдЯ рд╢реЗрддреА рд╡рд╛рдкрд░рд▓реНрдпрд╛рдмрджреНрджрд▓ <br> рдзрдиреНрдпрд╡рд╛рдж!</div>
    <div style="margin-top: 40px; color: var(--gold); font-weight: bold; letter-spacing: 2px;">ЁЯМ▒ SMART SHETI</div>
</div>

<div class="header">
  <div class="logo">ЁЯМ╛ Smart Sheti</div>
  <div class="header-actions">
    <div class="action-circle" onclick="location.href='kharch-diary.html'">ЁЯТ░</div>
    <div class="action-circle" onclick="location.href='setting.html'">тЪЩя╕П</div>
  </div>
</div>

<button class="btn weather-btn" onclick="location.href='weather.html'">ЁЯМж рдЖрдЬрдЪрдВ рд╣рд╡рд╛рдорд╛рди</button>
<button class="btn spray-btn" onclick="alert('рд╣рд╡рд╛рдорд╛рди рддрдкрд╛рд╕рдд рдЖрд╣реЗ...')">ЁЯЪ┐ рдлрд╡рд╛рд░рдгреА рд╕рд▓реНрд▓рд╛</button>
<button class="btn ai-btn" onclick="location.href='ai.html'">ЁЯдЦ AI рд╕рд▓реНрд▓рд╛</button>
<button class="btn ai-btn" onclick="location.href='disease.html'">ЁЯУ╕ рд░реЛрдЧ рдУрд│рдЦ</button>
<button class="btn weather-btn" onclick="location.href='community.html'">ЁЯдЭ рдЧрд╛рд╡ рдЪрд░реНрдЪрд╛</button>

<button class="btn" style="background:#FFD700;color:#000"
 onclick="location.href='farmer-card.html'">ЁЯкк рд╢реЗрддрдХрд░реА рдХрд╛рд░реНрдб рддрдпрд╛рд░ рдХрд░рд╛</button>

<button class="btn ai-btn" onclick="location.href='crop-calendar.html'">ЁЯМ▒ рдкреАрдХ рд╡реЗрд│рд╛рдкрддреНрд░рдХ</button>
<button class="btn notify-btn" onclick="location.href='news.html'">ЁЯУ░ рд╢реЗрддреА рдмрд╛рддрдореНрдпрд╛</button>

<button class="btn market-btn"
 onclick="location.href='https://www.krushikranti.com/bajarbhav'">
ЁЯУИ рдЖрдЬрдЪреЗ рдмрд╛рдЬрд╛рд░рднрд╛рд╡</button>

<button class="btn calc-btn" onclick="location.href='calculator.html'">ЁЯзк рдЦрдд рдХреЕрд▓реНрдХреНрдпреБрд▓реЗрдЯрд░</button>
<button class="btn schedule-btn" onclick="location.href='spray-schedule.html'">ЁЯЪЬ рдлрд╡рд╛рд░рдгреА рд╡реЗрд│рд╛рдкрддреНрд░рдХ</button>

<button class="btn" style="background:#2e7d32; color:white; padding:15px 25px; border:none; border-radius:12px; font-size:18px; font-weight:bold; cursor:pointer; width:100%; box-shadow: 0 4px 6px rgba(0,0,0,0.1);" 
 onclick="location.href='myfarm.html'">
    ЁЯМ╛ рдорд╛рдЭрдВ рд╢реЗрдд (рд╕реНрдорд╛рд░реНрдЯ рд╕рд▓реНрд▓рд╛)
</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const app=initializeApp({
 apiKey:"AIzaSyA1M7dJ9KFVe1GAGWPPqLuAT7BEuIKsZkM",
 authDomain:"smart-sheti-6512e.firebaseapp.com",
 projectId:"smart-sheti-6512e",
 storageBucket:"smart-sheti-6512e.firebasestorage.app",
 messagingSenderId:"1086459599128",
 appId:"1:1086459599128:web:03a34ed9ea2b95b1ebe66d"
});

const auth=getAuth(app);
let checked=false;
onAuthStateChanged(auth,u=>{
 if(!checked){
  checked=true;
  if(!u) location.replace("index.html");
 }
});
</script>

<script>
  // --- рдирд╡реАрди рд╢рдХреНрддрд┐рд╢рд╛рд▓реА Exit рд▓реЙрдЬрд┐рдХ ---
  let lastPressTime = 0;

  // рд╣реА рдорд╣рддреНрддреНрд╡рд╛рдЪреА рд╕реНрдЯреЗрдк рдЖрд╣реЗ: рджрд░ релрежреж рдорд┐рд▓реАрд╕реЗрдХрдВрджрд╛рд▓рд╛ рдЗрддрд┐рд╣рд╛рд╕ рдкреБрдиреНрд╣рд╛ рд╕реЗрдЯ рдХрд░рдгреЗ
  setInterval(function() {
      window.history.pushState(null, null, window.location.href);
  }, 500);

  window.addEventListener('popstate', function() {
      let now = new Date().getTime();
      
      if (now - lastPressTime < 2000) {
          // рджреБрд╕рд░рд╛ рдкреНрд░реЗрд╕: рдкреВрд░реНрдг рд╕реНрдХреНрд░реАрди рджрд╛рдЦрд╡рд╛ рдЖрдгрд┐ ре▓рдк рдмрдВрдж рдХрд░рд╛
          document.getElementById("toastMessage").style.display = "none";
          document.getElementById("fullExitScreen").style.display = "flex";
          
          setTimeout(() => {
              // ре▓рдк рдкреВрд░реНрдг рдмрдВрдж рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА
              window.close(); 
              // рдЬрд░ window.close рдХрд╛рдо рдирд╛рд╣реА рдХреЗрд▓рдВ рддрд░ рдмреЕрдХ рдЬрд╛
              window.history.go(-20); 
          }, 2500);
      } else {
          // рдкрд╣рд┐рд▓рд╛ рдкреНрд░реЗрд╕: 'Exit тЬЕ' рдкрдЯреНрдЯреА рджрд╛рдЦрд╡рд╛
          const toast = document.getElementById("toastMessage");
          toast.style.display = "block";
          
          setTimeout(() => {
              toast.style.display = "none";
          }, 2000);
          
          lastPressTime = now;
      }
  });

  // рдЕрдкрдбреЗрдЯ рдкреЙрдк-рдЕрдк
  const LATEST_VERSION = "1.0"; 
  function checkAppUpdate() {
      const savedVersion = localStorage.getItem("userAppVersion");
      if (savedVersion !== LATEST_VERSION) {
          document.getElementById("updatePopup").style.display = "flex";
      }
  }
  function closeUpdatePopup() {
      localStorage.setItem("userAppVersion", LATEST_VERSION);
      document.getElementById("updatePopup").style.display = "none";
  }

  window.addEventListener('load', checkAppUpdate);

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('Home: Registered!'))
        .catch(err => console.log('Home: Failed!', err));
    });
  }
</script>

</body>
</html>
