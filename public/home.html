<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Sheti - Home</title>

<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
<script>
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  
  OneSignalDeferred.push(async function(OneSignal) {
    await OneSignal.init({
      appId: "fdb7e40a-dc5c-4620-85d7-d99e5db6eb91",
      allowLocalhostAsSecureOrigin: true,
      slidedown: {
        prompts: [
          {
            type: "push",
            autoPrompt: true, 
            text: {
              actionMessage: "рддреБрдореНрд╣рд╛рд▓рд╛ рд╢реЗрддреАрд╡рд┐рд╖рдпрдХ рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рд╕реВрдЪрдирд╛ рдЖрдгрд┐ рдкрд╛рд╡рд╕рд╛рдЪрд╛ рдЗрд╢рд╛рд░рд╛ рдорд┐рд│рд╡рд╛рдпрдЪрд╛ рдЖрд╣реЗ рдХрд╛?",
              acceptButton: "рд╣реЛ, Allow рдХрд░рд╛",
              cancelButton: "рдирдХреЛ, Deny рдХрд░рд╛"
            },
            delay: {
              pageViews: 1,
              timeDelay: 3 // рдкреЗрдЬ рд▓реЛрдб рдЭрд╛рд▓реНрдпрд╛рд╡рд░ рей рд╕реЗрдХрдВрджрд╛рдиреЗ рдкреЙрдк-рдЕрдк рджрд┐рд╕реЗрд▓
            }
          }
        ]
      }
    });
  });

  // рд╣рд╡рд╛рдорд╛рди рддрдкрд╛рд╕реВрди рдСрдЯреЛрдореЕрдЯрд┐рдХ рдмреЕрдХрдЧреНрд░рд╛рдЙрдВрдб рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди
  async function checkWeatherAndNotify() {
      const weatherKey = "4e520dcafeb783757272573493f6a2d3";
      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(async (position) => {
              const lat = position.coords.latitude;
              const lon = position.coords.longitude;
              try {
                  const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${weatherKey}&units=metric`);
                  const data = await response.json();

                  if (data.weather[0].main === "Rain" || data.weather[0].main === "Drizzle") {
                      window.OneSignalDeferred.push(function(OneSignal) {
                          OneSignal.Notifications.displaySelfClickableNotification(
                              "ЁЯМзя╕П рдлрд╡рд╛рд░рдгреА рдЗрд╢рд╛рд░рд╛", 
                              `рд╕рдзреНрдпрд╛ рддреБрдордЪреНрдпрд╛ рдкрд░рд┐рд╕рд░рд╛рдд (${data.name}) рдкрд╛рдКрд╕ рджрд┐рд╕рдд рдЖрд╣реЗ. рдХреГрдкрдпрд╛ рдлрд╡рд╛рд░рдгреА рдЯрд╛рд│рд╛.`,
                              "https://smart-sheti.vercel.app/"
                          );
                      });
                  }
              } catch (e) { console.log("Weather error"); }
          });
      }
  }
  setTimeout(checkWeatherAndNotify, 5000);
</script>

<style>
body{
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#e8f5e9;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}

.logo{
  font-size:28px;
  font-weight:bold;
  color:#2e7d32;
  margin-bottom:25px;
}

.btn{
  width:100%;
  max-width:300px;
  padding:14px 16px;
  margin:10px 0;
  font-size:17px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  color:white;
  box-shadow:0 4px 8px rgba(0,0,0,0.12);
  transition: 0.3s;
}

.btn:active { transform: scale(0.98); }
.weather-btn{ background:#1565c0; }
.spray-btn { background:#00796b; } 
.ai-btn{ background:#2e7d32; }
.notify-btn{ background:#ef6c00; }
  
.market-btn {
    background-color: #2e7d32 !important;
    color: white !important;
    opacity: 1 !important;
}
</style>
</head>

<body>

<div class="logo">ЁЯМ╛ Smart Sheti</div>

<button class="btn weather-btn" onclick="location.href='weather.html'">
  ЁЯМж рдЖрдЬрдЪрдВ рд╣рд╡рд╛рдорд╛рди
</button>

<button class="btn spray-btn" onclick="checkWeatherForSpray()">
  ЁЯЪ┐ рдлрд╡рд╛рд░рдгреА рд╕рд▓реНрд▓рд╛ (рдкрд╛рдКрд╕ рдЪреЗрдХ рдХрд░рд╛)
</button>

<button class="btn ai-btn" onclick="location.href='ai.html'">
  ЁЯдЦ AI рд╕рд▓реНрд▓рд╛
</button>

<button class="btn ai-btn" onclick="location.href='disease.html'">
  ЁЯУ╕ рд░реЛрдЧ рдУрд│рдЦ (рдлреЛрдЯреЛ)
</button>

<button class="btn ai-btn" onclick="location.href='crop-calendar.html'">
  ЁЯМ▒ Crop Calendar
</button>

<button class="btn notify-btn" onclick="location.href='news.html'">
  ЁЯУ░ рд╢реЗрддреА рдмрд╛рддрдореНрдпрд╛
</button>

<button class="btn notify-btn" onclick="triggerPushPrompt()">
  ЁЯФФ рдкрд╛рд╡рд╕рд╛рдЪрд╛ Alert ON рдХрд░рд╛
</button>

<button class="btn market-btn" onclick="location.href='market.html'">
  <span class="icon">ЁЯУИ</span> Market (рдмрд╛рдЬрд╛рд░рднрд╛рд╡)
</button>

<button onclick="location.href='calculator.html'" style="width: 100%; max-width:300px; padding: 18px; margin: 10px 0; border: none; border-radius: 15px; background: linear-gradient(135deg, #2e7d32, #43a047); color: white; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
  ЁЯзк рдЦрдд рдХреЕрд▓реНрдХреНрдпреБрд▓реЗрдЯрд░ (A-Z)
</button>

<button onclick="location.href='spray-schedule.html'" style="width: 100%; max-width:300px; padding: 18px; margin: 10px 0; border: none; border-radius: 15px; background: linear-gradient(135deg, #ef6c00, #fb8c00); color: white; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
  ЁЯЪЬ рдлрд╡рд╛рд░рдгреА рд╡реЗрд│рд╛рдкрддреНрд░рдХ (A-Z)
</button>
  
<script>
// рдореЕрдиреНрдпреБрдЕрд▓реА рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдЪрд╛рд▓реВ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдВрдХреНрд╢рди
function triggerPushPrompt() {
  window.OneSignalDeferred.push(function(OneSignal) {
    OneSignal.Slidedown.promptPush();
  });
}

// рдлрд╡рд╛рд░рдгреАрд╕рд╛рдареА рд╣рд╡рд╛рдорд╛рди рддрдкрд╛рд╕рдгреЗ
function checkWeatherForSpray() {
  if (!navigator.geolocation) {
    alert("рд▓реЛрдХреЗрд╢рди рд╕рдкреЛрд░реНрдЯ рдирд╛рд╣реА.");
    return;
  }
  alert("рд╣рд╡рд╛рдорд╛рди рддрдкрд╛рд╕рдд рдЖрд╣реЗ...");
  navigator.geolocation.getCurrentPosition(async (pos) => {
    const { latitude, longitude } = pos.coords;
    try {
      const weatherKey = "4e520dcafeb783757272573493f6a2d3";
      const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${weatherKey}&units=metric`);
      const data = await res.json();
      
      if (data.weather[0].main === "Rain" || data.weather[0].main === "Drizzle") {
        alert("ЁЯМзя╕П рдкрд╛рдКрд╕ рд╕реБрд░реВ рдЖрд╣реЗ. рдлрд╡рд╛рд░рдгреА рдкреБрдвреЗ рдврдХрд▓рд╛! тЭМ");
      } else {
        alert("тЬЕ рд╣рд╡рд╛рдорд╛рди рд╕рд╛рдл рдЖрд╣реЗ. рддреБрдореНрд╣реА рдлрд╡рд╛рд░рдгреА рдХрд░реВ рд╢рдХрддрд╛. ЁЯМ┐");
      }
    } catch (err) {
      alert("рдорд╛рд╣рд┐рддреА рдорд┐рд│рд╡рдгреНрдпрд╛рдд рдЕрдбрдЪрдг рдЖрд▓реА.");
    }
  });
}
</script>

</body>
</html>
