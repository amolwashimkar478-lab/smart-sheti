<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<title>Smart Sheti - Home</title>

<style>
body{
  font-family: Arial;
  background: #e8f5e9;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

h2{
  color:#2e7d32;
  margin-bottom:10px;
}

button{
  padding:10px 15px;
  border:none;
  background:#2e7d32;
  color:#fff;
  border-radius:8px;
  cursor:pointer;
  margin:5px;
}

button:hover{
  background:#1b5e20;
}

#weatherBox{
  background:#ffffff;
  border-radius:10px;
  padding:10px;
  width:100%;
  max-width:400px;
  margin:10px 0;
  border:1px solid #ccc;
  display:none;
}

/* Chat */
#chatBox{
  width: 100%;
  max-width: 400px;
  height: 350px;
  background: #fff;
  border-radius: 10px;
  padding: 10px;
  overflow-y: scroll;
  border:1px solid #ccc;
}

.user, .ai{
  padding: 8px 12px;
  margin:6px 0;
  border-radius:10px;
  max-width: 80%;
}

.user{
  background: #c8e6c9;
  align-self: flex-end;
}

.ai{
  background: #e0f2f1;
  align-self: flex-start;
}

#inputBox{
  margin-top:10px;
  display:flex;
  width: 100%;
  max-width:400px;
}

#userInput{
  flex:1;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

#sendBtn{
  margin-left:5px;
}
</style>
</head>

<body>

<h2>ЁЯМ╛ Smart Sheti</h2>

<!-- ЁЯМж Weather Button -->
<button onclick="getWeather()">ЁЯМж рдЖрдЬрдЪрдВ рд╣рд╡рд╛рдорд╛рди</button>

<div id="weatherBox"></div>

<!-- ЁЯМ▒ AI Chat -->
<h2>ЁЯдЦ рд╢реЗрддрдХрд░реА AI рдорд┐рддреНрд░</h2>

<select id="lang">
  <option value="mr">рдорд░рд╛рдареА</option>
  <option value="en">English</option>
</select>

<div id="chatBox"></div>

<div id="inputBox">
  <input type="text" id="userInput" placeholder="рддреБрдордЪрд╛ рдкреНрд░рд╢реНрди рд▓рд┐рд╣рд╛...">
  <button id="sendBtn">Send</button>
</div>

<script>
/* ================= WEATHER ================= */

function getWeather(){
  if(!navigator.geolocation){
    alert("GPS рд╕рдкреЛрд░реНрдЯ рдирд╛рд╣реА");
    return;
  }

  navigator.geolocation.getCurrentPosition(pos=>{
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    fetch(`/api/weather?lat=${lat}&lon=${lon}`)
      .then(res=>res.json())
      .then(data=>{
        document.getElementById("weatherBox").style.display="block";
        document.getElementById("weatherBox").innerHTML = `
          <b>ЁЯУН ${data.name}</b><br>
          ЁЯМб рддрд╛рдкрдорд╛рди: ${data.main.temp} ┬░C<br>
          ЁЯТз рдЖрд░реНрджреНрд░рддрд╛: ${data.main.humidity}%<br>
          ЁЯМе рд╣рд╡рд╛рдорд╛рди: ${data.weather[0].description}
        `;
      })
      .catch(()=>{
        alert("Weather рдорд┐рд│рд╛рд▓рдВ рдирд╛рд╣реА");
      });
  });
}

/* ================= AI CHAT ================= */

const chatBox = document.getElementById('chatBox');
const input = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const lang = document.getElementById('lang');

sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keypress', e => { if(e.key==='Enter') sendMessage() });

function addMessage(text, sender){
  const div = document.createElement('div');
  div.className = sender;
  div.innerText = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage(){
  const userText = input.value.trim();
  if(!userText) return;

  addMessage(userText,'user');
  input.value = '';

  // ЁЯФе Gemini Backend (Vercel API)
  const response = await fetch('/api/chat', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      prompt:userText,
      language: lang.value
    })
  });

  const data = await response.json();
  addMessage(data.reply || "рдЙрддреНрддрд░ рдорд┐рд│рд╛рд▓рдВ рдирд╛рд╣реА",'ai');
}
</script>

</body>
</html>
