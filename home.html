<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Sheti - Home</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#e8f5e9;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}

.logo{
  font-size:28px;
  font-weight:bold;
  color:#2e7d32;
  margin-bottom:25px;
}

/* Common button */
.btn{
  width:100%;
  max-width:300px;
  padding:14px 16px;
  margin:10px 0;
  font-size:17px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  color:white;
  box-shadow:0 4px 8px rgba(0,0,0,0.12);
}

/* Weather */
.weather-btn{ background:#1565c0; }
.weather-btn:hover{ background:#0d47a1; }

/* AI */
.ai-btn{ background:#2e7d32; }
.ai-btn:hover{ background:#1b5e20; }

/* Notification */
.notify-btn{ background:#ef6c00; }
.notify-btn:hover{ background:#e65100; }
</style>
</head>

<body>

<div class="logo">ЁЯМ╛ Smart Sheti</div>

<!-- ЁЯМж Weather -->
<button class="btn weather-btn" onclick="goToWeather()">
  ЁЯМж рдЖрдЬрдЪрдВ рд╣рд╡рд╛рдорд╛рди
</button>

<!-- ЁЯдЦ AI -->
<button class="btn ai-btn" onclick="location.href='ai.html'">
  ЁЯдЦ AI рд╕рд▓реНрд▓рд╛
</button>

<!-- ЁЯМ▒ Crop Calendar -->
<button class="btn ai-btn" onclick="location.href='crop-calendar.html'">
  ЁЯМ▒ Crop Calendar
</button>

<!-- ЁЯФФ Rain Notification -->
<button class="btn notify-btn" onclick="enableNotification()">
  ЁЯФФ рдкрд╛рд╡рд╕рд╛рдЪрд╛ Alert ON
</button>

<!-- ЁЯУ╕ рд░реЛрдЧ рдУрд│рдЦ -->
<button class="btn ai-btn" onclick="location.href='disease.html'">
  ЁЯУ╕ рд░реЛрдЧ рдУрд│рдЦ (рдлреЛрдЯреЛ)
</button>

  <!-- ЁЯУ░ District-wise News -->
<button class="btn notify-btn" onclick="location.href='news.html'">
  ЁЯУ░ рд╢реЗрддреА рдмрд╛рддрдореНрдпрд╛
</button>

<script>
function goToWeather(){
  window.location.href = "weather.html";
}

// ЁЯФФ Notification Permission
function enableNotification(){
  if(!("Notification" in window)){
    alert("рддреБрдордЪреНрдпрд╛ browser рдордзреНрдпреЗ notification support рдирд╛рд╣реА");
    return;
  }

  Notification.requestPermission().then(permission=>{
    if(permission === "granted"){
      alert("тЬЕ рдкрд╛рд╡рд╕рд╛рдЪрд╛ alert рдЪрд╛рд▓реВ рдЭрд╛рд▓рд╛");

      // Example test notification
      new Notification("ЁЯМзя╕П Smart Sheti", {
        body: "рдкрд╛рд╡рд╕рд╛рдЪрд╛ alert рдЪрд╛рд▓реВ рдЖрд╣реЗ. рдкрд╛рдКрд╕ рдЖрд▓реНрдпрд╛рд╕ рд╕реВрдЪрдирд╛ рдорд┐рд│реЗрд▓ ЁЯМ╛"
      });
    }else{
      alert("тЭМ Notification allow рдХрд░рд╛");
    }
  });
}

// ЁЯУ░ District-based daily news notification
async function checkDailyNews(district){
  try{
    const res = await fetch(`/api/news?district=${district}`);
    const data = await res.json();
    if(data.articles && data.articles.length > 0){
      const article = data.articles[0];
      new Notification(`ЁЯУ░ ${district} рд╢реЗрддреА рдмрд╛рддрдореНрдпрд╛`, {
        body: article.title,
        icon: "https://cdn-icons-png.flaticon.com/512/1779/1779940.png"
      }).onclick = () => window.open(article.url, "_blank");
    }
  } catch(err){
    console.error("News fetch error:", err);
  }
}

// Schedule daily news at 7AM
function scheduleDailyNews(district){
  const now = new Date();
  const target = new Date();
  target.setHours(7,0,0,0); // 7 AM
  if(now > target) target.setDate(target.getDate() + 1);
  const timeout = target - now;

  setTimeout(()=>{
    checkDailyNews(district);
    setInterval(()=>checkDailyNews(district), 24*60*60*1000); // 24h interval
  }, timeout);
}

// ЁЯМЮ Auto-run on page load
window.onload = () => {
  const userDistrict = "Pune"; // user district dynamic рдареЗрд╡рддрд╛ рдпреЗрдИрд▓
  if(Notification.permission === "granted") scheduleDailyNews(userDistrict);
};
</script>

</body>
</html>
